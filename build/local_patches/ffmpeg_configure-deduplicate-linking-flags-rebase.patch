diff --git a/configure b/configure
index ff6a5c3600..e84b2d679c 100755
--- a/configure
+++ b/configure
@@ -7820,6 +7820,19 @@ enabled stripping || striptype=""
 
 config_files="$TMPH ffbuild/config.mak doc/config.texi"
 
+if test "${#extralibs}" -gt 3000; then
+    extralib_dirs=""
+    for extralib_dir in $(printf '%s\n' $LDFLAGS $extralibs | grep '^-L' | tac | awk '!x[$0]++' | tac | tr '\n' ' '); do
+        test -d "${extralib_dir#-L}" && extralib_dirs+=" $extralib_dir"
+    done
+    extralibs_tmp="$(printf '%s\n' $extralibs | grep -v '^-L' | tr '\n' ' ')"
+    if test "${#extralibs_tmp}" -gt 2500; then
+        extralibs="$(printf '%s\n' $extralib_dirs $extralibs_tmp | tac | awk '!x[$0]++' | tac | tr '\n' ' ')"
+    else
+        extralibs="$extralib_dirs $extralibs_tmp"
+    fi
+fi
+
 cat > ffbuild/config.mak <<EOF
 # Automatically generated by configure - do not modify!
 ifndef FFMPEG_CONFIG_MAK
